<%- include('header') %>

<div class="container">
    <div class="page-header">
        <h1><%= category ? category + ' ë¦¬ë·°' : 'ì „ì²´ ë¦¬ë·°' %></h1>
        <div class="filter-options">
            <select id="category-filter" class="form-select">
                <option value="">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
                <option value="ì „ìì œí’ˆ" <%= category === 'ì „ìì œí’ˆ' ? 'selected' : '' %>>ì „ìì œí’ˆ</option>
                <option value="ìƒí™œìš©í’ˆ" <%= category === 'ìƒí™œìš©í’ˆ' ? 'selected' : '' %>>ìƒí™œìš©í’ˆ</option>
                <option value="íŒ¨ì…˜" <%= category === 'íŒ¨ì…˜' ? 'selected' : '' %>>íŒ¨ì…˜</option>
                <option value="ì‹í’ˆ" <%= category === 'ì‹í’ˆ' ? 'selected' : '' %>>ì‹í’ˆ</option>
            </select>
        </div>
    </div>

    <% if (reviews.length === 0) { %>
    <div class="empty-state">
        <p>ì•„ì§ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
        <a href="/" class="btn btn-primary">í™ˆìœ¼ë¡œ ê°€ê¸°</a>
    </div>
    <% } else { %>
    <div class="review-grid">
        <% reviews.forEach(review => { %>
        <article class="review-card">
            <a href="/reviews/<%= review.slug %>">
                <div class="review-image">
                    <img src="<%= review.featuredImage || '/images/default-review.svg' %>" alt="<%= review.title %>">
                </div>
                <div class="review-content">
                    <span class="review-category"><%= review.category %></span>
                    <h3><%= review.title %></h3>
                    <p><%= review.metaDescription || review.content.substring(0, 150) %>...</p>
                    <div class="review-meta">
                        <span class="author">by <%= review.author.username %></span>
                        <span class="date"><%= new Date(review.publishedAt || review.createdAt).toLocaleDateString('ko-KR') %></span>
                    </div>
                    <div class="review-stats">
                        <span class="views"><i class="icon-eye"></i> <%= review.views %></span>
                        <span class="likes"><i class="icon-heart"></i> <%= review.likes %></span>
                    </div>
                </div>
            </a>
        </article>
        <% }) %>
    </div>

    <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
    <% if (totalPages > 1) { %>
    <div class="pagination">
        <% if (currentPage > 1) { %>
        <a href="?page=<%= currentPage - 1 %><%= category ? '&category=' + category : '' %>" class="pagination-btn">
            &laquo; ì´ì „
        </a>
        <% } %>
        
        <% 
        let startPage = Math.max(1, currentPage - 2);
        let endPage = Math.min(totalPages, currentPage + 2);
        
        if (startPage > 1) { %>
            <a href="?page=1<%= category ? '&category=' + category : '' %>" class="pagination-btn">1</a>
            <% if (startPage > 2) { %>
                <span class="pagination-dots">...</span>
            <% } %>
        <% }
        
        for(let i = startPage; i <= endPage; i++) { %>
            <% if (i === currentPage) { %>
            <span class="pagination-current"><%= i %></span>
            <% } else { %>
            <a href="?page=<%= i %><%= category ? '&category=' + category : '' %>" class="pagination-btn"><%= i %></a>
            <% } %>
        <% }
        
        if (endPage < totalPages) { %>
            <% if (endPage < totalPages - 1) { %>
                <span class="pagination-dots">...</span>
            <% } %>
            <a href="?page=<%= totalPages %><%= category ? '&category=' + category : '' %>" class="pagination-btn">
                <%= totalPages %>
            </a>
        <% } %>
        
        <% if (currentPage < totalPages) { %>
        <a href="?page=<%= currentPage + 1 %><%= category ? '&category=' + category : '' %>" class="pagination-btn">
            ë‹¤ìŒ &raquo;
        </a>
        <% } %>
    </div>
    <% } %>
    <% } %>
</div>

<style>
.page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 2rem 0;
}

.filter-options {
    display: flex;
    gap: 1rem;
}

.form-select {
    padding: 0.5rem 1rem;
    border: 1px solid #ddd;
    border-radius: 4px;
    background: white;
    cursor: pointer;
}

.review-stats {
    margin-top: 0.5rem;
    display: flex;
    gap: 1rem;
    font-size: 0.875rem;
    color: #6c757d;
}

.icon-eye::before {
    content: "ğŸ‘ï¸";
    margin-right: 0.25rem;
}

.icon-heart::before {
    content: "â¤ï¸";
    margin-right: 0.25rem;
}

.pagination-dots {
    padding: 0.5rem;
    color: #6c757d;
}
</style>

<script>
// ì¹´í…Œê³ ë¦¬ í•„í„° ë³€ê²½
document.getElementById('category-filter').addEventListener('change', function() {
    const category = this.value;
    if (category) {
        window.location.href = `/reviews/category/${category}`;
    } else {
        window.location.href = '/reviews';
    }
});
</script>

<%- include('footer') %>
